<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WritingApp</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/request/2.88.0/request.min.js"></script>

    <script src="files js/Types of messages.js"></script>
    <script src="files js/last_maessage.js"></script>



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.slim.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2"></script>

</head>
<style>
    body {
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background: #ccc;
        margin: 0;
        min-height: 100vh;
        width: 80%;
        margin-left: 10%;
        background-image: url("wallpaper-dark.jpg");
      
    }

    .chat-container {
        flex-direction: column-reverse;

        font-size: 20px;
        background-image: url("w.jpg");
        max-width: 600px;
        margin-top: -5%;
        padding: 20px;
        max-height: 500px;
        background-color: rgba(255, 255, 255, 0.9);
        /* Semi-transparent white background */
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        /* Box shadow for a card-like appearance */
        border: 1px solid #ccc;
        display: flex;

        overflow-y: scroll;
        margin-left: 25%;
        border: 10px solid rgb(41, 42, 42);
        box-shadow:
            rgba(0, 0, 0, 0) 0px 0px 0px 0px,
            rgba(0, 0, 0, 0) 0px 0px 0px 0px,
            rgba(0, 0, 0, 0.12) 0px 1px 1px 0px,
            rgb(115, 117, 118) 0px 0px 0px 5px,
            rgba(0, 0, 0, 0) 0px 0px 0px 0px,
            rgba(0, 0, 0, 0) 0px 0px 0px 0px,
            rgba(60, 66, 87, 0.08) 0px 2px 5px 0px;

    }

    .message-balloon {
        background-color: #035d4c;
        color: #fff;
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 5%;
        clear: both;
        float: left;
        width: auto;
        text-align: left;
    }

    .message-balloon-received {
        background-color: #1f2c34;
        color: #fff;
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 20px;
        clear: both;
        float: right;
        width: auto;
        text-align: right;

    }





    #text {
        border: 0;
        flex: 1 1 auto;
        font-size: 16px;
        margin: 0;
        outline: none;
        min-width: 50px;
        margin-left: 30%;
    }


    #user_img {
        border-radius: 50%;
        width: 10%;
        height: 10%;
        margin-bottom: 1%;

    }

    #margin-bottom {
        margin-bottom: -5%
    }

    #margin_bottom_Another_user {
        text-align: right;
        margin-bottom: 5%
    }

    #Another_user {
        border-radius: 50%;
        width: 10%;
        height: 10%;
        text-align: right;
        margin-left: 90%;
    }

    .date_day {
        background-color: #1f2c34;
        /* Green background for sent messages */
        color: #fff;
        /* Text color for sent messages */
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 10px;
        width: 24%;
        text-align: center;
        margin-left: 40%;
        margin-right: 50%;

    }

    .input-msg {
        border: 0;
        flex: 1 1 auto;
        font-size: 16px;
        margin: 0;
        outline: none;
        min-width: 50px;
    }




    .photo i {
        display: block;
        color: #7d8488;
        font-size: 24px;
        transform: translate(-50%, -50%);
        position: relative;
        top: 50%;
        left: 50%;
    }

    .conversation-compose {
        height: 50px;
        width: 245%;




    }

    .conversation-compose div {
        background: #fff;
        height: 100%;
        width: 200%;

    }



    .margin-right {
        margin-right: 65%;



    }




    .photo:after {
        border-width: 0px 0 10px 10px;
        border-color: transparent transparent transparent #fff;
        border-style: solid;
        position: absolute;
        width: 0;
        height: 0;
        content: "";
        top: 0;
        right: -10px;
    }

    .photo i {
        display: block;
        color: #7d8488;
        font-size: 24px;
        transform: translate(-50%, -50%);
        position: relative;
        top: 50%;
        left: 50%;
    }

    .flex {
        display: flex;

    }



    .send {
        background: transparent;
        border: 0;
        cursor: pointer;
        flex: 0 0 auto;
        padding: 0;
        position: relative;
        outline: none;
        flex-direction: column;
        justify-content: space-between;
        margin-top: -5%
    }

    .exit {
        background: transparent;
        border: 0;
        cursor: pointer;
        padding: 0;
        position: relative;
        outline: none;
        margin-left: 0.5%;
        margin-top: -70%
    }

    .send .circle {
        Cursor: pointer;
        background: #008a7c;
        border-radius: 50%;
        color: #fff;
        position: relative;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .exit .circle {
        Cursor: pointer;
        background: #8a4500;
        border-radius: 50%;
        color: #fff;
        position: relative;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
    }


    #emoji-1 {
        width: 60px;
        height: 60px;
        border-radius: 80%;
        background-color: rgba(204, 204, 204, 0)2c2;


    }

    #emoji-2 {
        width: 45px;
        height: 45px;
        border-radius: 80%;
        Cursor: pointer;
    }

    .iconify-icon {
        Cursor: pointer;

    }

    #smile {
        margin: 7;
    }

    .margin-left {
        margin-left: 25%;
    }

    input[type=text],
    textarea {
        padding: 12px;
        border: 1px solid #ccc;
        border-bottom-right-radius: 30px;
        height: 100px;
        width: 50%;
        margin: 0;
        margin-top: 2%;
        font-size: 24px
    }

    #all-emoji {
        Cursor: pointer;

        max-width: 300px;
        padding: 20px;
        max-height: 200px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        border: 1px solid #ccc;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        margin-left: -3%;
        margin-top: -20%;
        border: 10px solid rgb(41, 42, 42);
        box-shadow:
            rgba(0, 0, 0, 0) 0px 0px 0px 0px,
            rgba(0, 0, 0, 0) 0px 0px 0px 0px,
            rgba(0, 0, 0, 0.12) 0px 1px 1px 0px,
            rgb(115, 117, 118) 0px 0px 0px 5px,
            rgba(0, 0, 0, 0) 0px 0px 0px 0px,
            rgba(0, 0, 0, 0) 0px 0px 0px 0px,
            rgba(60, 66, 87, 0.08) 0px 2px 5px 0px;

    }

    #all-emoji .row {
        margin-left: 0%;
    }

    .emojis {
        font-size: 24px
    }

    .emojis:hover {
        Cursor: pointer;
        font-size: 54px
    }


    *[id^="img_user"] {
        width: 50px;
        height: 50px;
        border-radius: 50%
    }

    *[id^="message-"] {
        Cursor: pointer;

    }


    .chat-list {
        position: relative;
        height: calc(100% - 170px);
        overflow-y: auto;
        width: 70%;
        box-shadow: 0px 1px 1px  0 rgba(0,0,0,0.5), 0px 2px 5px 0 rgba(0,0,0,0.6);
        background-color:white



    }

    .chat-list .chat-box {
        position: relative;
        width: 100%;
        display: flex;
        /*   justify-content: center; */
        align-items: center;
        cursor: pointer;
        padding: 15px;
        border-bottom: 1px solid #eee;

    }

    .chat-list .chat-box .img-box {
        position: relative;
        width: 55px;
        height: 45px;
        overflow: hidden;
        border-radius: 50%;
    }

    .chat-list .chat-box .chat-details {
        width: 100%;
        margin-left: 10px;
    }

    .chat-list .chat-box .chat-details .text-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2px;
    }

    .chat-list .chat-box .chat-details .text-head h4 {
        font-size: 1.1em;
        font-weight: 600;
        color: #000;
    }

    .chat-list .chat-box .chat-details .text-head .time {
        font-size: 0.8em;
        color: #aaa;
    }

    .chat-list .chat-box .chat-details .text-message {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chat-list .chat-box .chat-details .text-message p {
        color: #282727;
        font-size: 0.9em;
        overlay: hidden;
    }

    img {
        width: 100%;
        object-fit: cover;
    }

    .chat-list .chat-box .chat-details .text-message b {
        background: #06e744;
        color: #fff;
        min-width: 20px;
        height: 20px;
        border-radius: 50%;
        /*   text-align: center; */
        font-size: 0.8em;
        font-weight: 400;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .chat-list .active {
        background: #ebebeb;
    }

    .chat-list .chat-box:hover {
        background: #f5f5f5;
    }

    .chat-list .chat-box .chat-details .text-head .unread {
        color: #06e744;
        
    }

    .online{
        margin-left: 90%;
        margin-top: -30%;
        box-shadow: 0px 1px 1px  0 rgba(0,0,0,0.5), 0px 2px 5px 0 rgba(0,0,0,0.6);
        background-color:white
    }

</style>

<body>
    <h1>WritingApp</h1>

    <div class="chat-list" id="chats" style=" display:none">
        <div class="chat-box" onclick="activation(1)">
            <div class="img-box">
                <img class="img-cover" id="img_user1" src="" />
            </div>
            <div class="chat-details">
                <div class="text-head" id="user-name1">
                </div>
                <div class="text-message" id="p-1">
                </div>
            </div>
        </div>
        <div class="chat-box" onclick="activation(2)">
            <div class="img-box">
                <img class="img-cover" id="img_user2" src="" />
            </div>
            <div class="chat-details">
                <div class="text-head" id="user-name2">
                </div>
                <div class="text-message" id="p-2">
                </div>
            </div>
        </div>
        <div class="chat-box" onclick="activation(3)">
            <div class="img-box">
                <img class="img-cover" id="img_user3" src="" />
            </div>
            <div class="chat-details">
                <div class="text-head" id="user-name3">
                </div>
                <div class="text-message" id="p-3">
                </div>
            </div>
        </div>
        <div class="chat-box" onclick="activation(4)">
            <div class="img-box">
                <img class="img-cover" id="img_user4" src="" />
            </div>
            <div class="chat-details">
                <div class="text-head" id="user-name4">
                </div>
                <div class="text-message" id="p-4">
                </div>
            </div>
        </div>
    </div>




    </div>
    <br />

    <div class="chat-container" style="display: none;" id="tableBody">
    </div>

    <div class="margin-left" id="button-send" style="display: none">
        <div class="form-row"></div>
        <span id="emoji-1" onclick="Show_emojis()">
            <img id="emoji-2" src="https://media.tenor.com/Wq-MvpjAJksAAAAC/emojilaugh-emoji.gif">
        </span>
        <textarea id="textarea" name="text" placeholder="Type a message.."></textarea>

        <button class="send" id="smile" onclick="post_data()">
            <span class="circle">

                <iconify-icon icon="zmdi:mail-send"></iconify-icon>
            </span>
        </button>
        <button class="exit" id="smile" onclick="Hide_di3()">
            <span class="circle">

                <iconify-icon icon="game-icons:exit-door"></iconify-icon>
            </span>
        </button>

    </div>


    <form class=" mt-5 mx-auto col-6 col-md-8 col-lg-6 was-validated " id="from" style="display: block;">
        <div class="form-row">
            <div class="col-md-4 mb-3">
                <input type="name" class="form-control" id="name" placeholder="Jane Doe.." value="" required>
            </div>
            <div class="col-md-4 mb-3">
                <input type="number" class="form-control mb-2" id="Phone" minlength="9" maxlength="10"
                    placeholder="050-1234567.." min="10" required><br />
            </div>
            <div class="custom-file col-md-4 mb-3">

                <input type="file" onchange="add_img()" class="custom-file-input" id="files" required>
                <label class="custom-file-label" for="file"><b>add a picture..</b></label>
            </div>
            <button onclick="Hide_div2()" class="btn btn-primary col" type="button">connect</button>
    </form>

    <br />
    </div>


    <img id="frame" style="display: none;" src="" width="0px" height="0px" />
    <p id="data"></p>
    <div id="all-emoji" style="display: none;"></div>
    <br />
    <div class="online">
        <div class="chat-details">
            <h3>online</h3>
            <div id="online">
            </div>

        </div>
    </div>

    <script>


        async function check_online() {

            Cells_manager.new_text = document.getElementById('name').value
            let time = time_now()
            let v = 0
            time += `:${Cells_manager.time_date.getSeconds()}`


            const url = "https://db-nmn5.onrender.com/online"

            let response = await fetch(`${url}`)
            if (!response.ok) {
                console.error('network problem')
                return
            }
            let data = await response.json()

            localStorage.setItem("check-online", JSON.stringify(data));
            Cells_manager._online = JSON.parse(localStorage.getItem("check-online"));

            let td = document.getElementById(`online`)
            td.innerHTML = ""
            for (let i = 0; i < Cells_manager._online.length; i++) {
                let td_son = document.createElement('span')
                if (Cells_manager._online[i].user !== "") {
                    td_son.innerHTML = `<span><b>${Cells_manager._online[i].user}:</b><sub>${Cells_manager._online[i].time}</sub></span>
                 `
                    td.appendChild(td_son)
                }
            }
            let jsonArray = Cells_manager._online
            let name = jsonArray.findIndex((item) => item.user === Cells_manager.new_text);

            for (let i = 0; i < Cells_manager._online.length; i++) {


                let a = Cells_manager._online[i].time.split(":")[2];

                let offline = time.split(":")[2]
                offline = offline + a
                let id = Cells_manager._online[i].id
                if (offline > 15) {
                    fetch(`https://db-nmn5.onrender.com/online/${id}`, {
                        method: 'DELETE'
                    })

                }

                v++
            }
            if (name === -1) {

                if (v === Cells_manager._online.length) {
                    fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: `{
                                "user": "${Cells_manager.new_text}",
                                "time": "${time}",
                                "id": "${Cells_manager._id_online}"
                                }`})
                    Cells_manager._id_online++

                }
            }
        }


        function Show_emojis() {
            const div1 = document.getElementById("all-emoji");
            div1.style.display = div1.style.display === "none" ? "block" : "none";
        }

        function copy_To_Clipboard(a) {
            const input = document.getElementById('textarea')
            input.value += a;
        }
        emoji_keyboard()
        function emoji_keyboard() {

            const url = "https://emoji-api.com/emojis?access_key=d43e0d96d977b343931bd3b2ae90d2d15f362bc0"
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    localStorage.setItem("emojis", JSON.stringify(data));
                })

            const emojis = JSON.parse(localStorage.getItem("emojis"))
            const father_div = document.getElementById('all-emoji')
            const son = document.createElement('div')
            son.classList.add("row");
            father_div.appendChild(son)
            let id_emojis = 3
            const max_for = 133

            for (let i = 0; i < max_for; i++) {
                for (let j = 0; j < 12; j++) {
                    if (id_emojis === 19) {
                        id_emojis++
                    }
                    const son_row = document.createElement('div')
                    son_row.innerHTML = `<div>${emojis[id_emojis].character}</div>`
                    son_row.classList.add("emojis");
                    son_row.id = `emoji-${id_emojis}`
                    const div = document.getElementById(`emoji-${id_emojis}`);
                    let img = emojis[id_emojis].character
                    son.appendChild(son_row)
                    add_Cell_Click_emoji(`${son_row.id}`, img)
                    id_emojis++
                }
            }
        }
        function add_Cell_Click_emoji(divId, number) { //Adds onClick to this div
            const div = document.getElementById(divId);
            div.addEventListener("click", function () {
                // קריאה לפונקציה `cell_click()` עם מספר התמונה
                copy_To_Clipboard(number);
            });
        }

        class Default_cells {
            constructor(_name, _img, _img_user, _Push, _size_array, _new_text, _new_time, _string_name,
                _message_list, _son, _type_class, _type_id, _time_date, _margin_bottom, _chat_n, _json_id, _online, _id_online) {
                this.name = _name
                this.img_user = _img_user
                this.img = _img
                this.Push = _Push
                this.size_array = _size_array
                this.new_text = _new_text
                this.new_time = _new_time
                this.string_name = _string_name
                this.message_list = _message_list
                this.son = _son
                this.type_class = _type_class
                this.type_id = _type_id
                this.time_date = _time_date
                this.margin_bottom = _margin_bottom
                this.chat_n = _chat_n
                this.json_id = _json_id
                this.online = _online
                this.id_online = _id_online

            }
        }
        const Cells_manager = new Default_cells(" ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ", " ")
        Cells_manager.son
        function Push_update() {
            fetch(`https://db-nmn5.onrender.com/chat${Cells_manager.chat_n}`)
                .then(res => res.json())
                .then(data => {
                    localStorage.setItem("check", JSON.stringify(data));
                    Cells_manager.Push = JSON.parse(localStorage.getItem("check"));
                    if (Cells_manager.name !== '') {
                        if (Cells_manager.Push.length !== Cells_manager.size_array.length) {
                            Cells_manager.Push = 0;
                            get();



                        }
                    }
                });
        }
        function Hide_div() {
            const div2 = document.getElementById("tableBody");
            div2.style.display = "block"
            const div3 = document.getElementById("button-send");
            div3.style.display = "block"
            // last_message()

        }

        function Hide_di3() {
            const div2 = document.getElementById("tableBody");
            div2.style.display = "none"
            const div3 = document.getElementById("button-send");
            div3.style.display = "none"
            const div5 = document.getElementById("chats");
            div5.style.display = div5.style.display === "none" ? "block" : "none";
            Cells_manager.size_array =
            Cells_manager.message_list = document.getElementById('tableBody')
            Cells_manager.message_list.innerHTML = ""

        }
        function Hide_div2() {
            const div4 = document.getElementById("from");
            div4.style.display = div4.style.display === "block" ? "none" : "none";
            const div5 = document.getElementById("chats");
            div5.style.display = div5.style.display === "none" ? "block" : "none";
            intervalId = setInterval(last_message, 500)
           

        }

        function activation(n) {
            if (Cells_manager.name !== '') {
                Hide_div2()
                Hide_div()
                Hide_div()
                Cells_manager.chat_n = n
                Cells_manager.json_id = id_message(n)

                Cells_manager.size_array = []
            }
            else {
                Swal.fire('Must enter a name', '', 'success')
            }
        }

        function add_img() {
            frame.src = URL.createObjectURL(event.target.files[0]);
            Cells_manager.img_user = frame.src
            Cells_manager._id_online = 0
            setInterval(check_online, 1000);
        }

        function id_message(i) {
            let url = `https://db-nmn5.onrender.com/chat${i}`
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    localStorage.setItem(`id${i}`, JSON.stringify(data));
                })

            let date = JSON.parse(localStorage.getItem(`id${i}`))
            let id_n = date

            const id = id_n.filter((item) => item.id === Math.max(...id_n.map((item) => item.id)));

            return id[0].id;
        }





        function post_data() {

            Cells_manager.new_text = document.getElementById('textarea').value
            Cells_manager.string_name = "text"
            Cells_manager.json_id += 1

            link_type()
            const input = document.getElementById('textarea')
            input.value = '';

            const url = `https://db-nmn5.onrender.com/chat${Cells_manager.chat_n}`
            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: `{
                            "user": "${Cells_manager.name}",
                            "${Cells_manager.string_name}": "${Cells_manager.new_text}",
                            "time": "${Cells_manager.new_time}",
                            "id": ${Cells_manager.json_id}
                        }`})

        }


        function isLink_img(text) {
            return text.includes(".gif") || text.includes(".png") ||
                text.includes(".jpg") || text.includes(".svg") || text.includes(".jpeg");
        }
        function link_type() {
            Cells_manager.new_time = time_now()
            let img_or_no = isLink_img(Cells_manager.new_text)
            let tube_or_no = Cells_manager.new_text.includes("youtu") || Cells_manager.new_text.includes("youtube")
            let tiktok_or_no = Cells_manager.new_text.includes("tiktok")
            let facebook_or_on = Cells_manager.new_text.includes("facebook")
            let link_or_no = Cells_manager.new_text.includes("http")

            Cells_manager.string_name = img_or_no ? "img" : tiktok_or_no ? "tiktok" : tube_or_no ? "tube" : "text";
            const all_or_no = !img_or_no && !tiktok_or_no && !tube_or_no && !facebook_or_on
            if (all_or_no) {
                if (link_or_no) {
                    Cells_manager.string_name = "link"
                }
            }

            if (facebook_or_on) {
                Cells_manager.new_text = Cells_manager.new_text.split("=")[1];
                Cells_manager.string_name = "face";
            }
        }


        function time_now() {
            Cells_manager.time_date = new Date();

            const hours = Cells_manager.time_date.getHours();

            const minutes = Cells_manager.time_date.getMinutes();

            const seconds = Cells_manager.time_date.getSeconds();
            let time = `${hours}:${minutes}`

            return time
        }

        function date_day_now() {
            Cells_manager.time_date = new Date();

            const day = Cells_manager.time_date.getDate()

            const Month = Cells_manager.time_date.getMonth() + 1

            const Year = Cells_manager.time_date.getFullYear()

            let Date_dey = `${day}/${Month}/${Year}`

            return Date_dey
        }

        function get() {

            fetch(`https://db-nmn5.onrender.com/chat${Cells_manager.chat_n}`)
                .then(res => res.json())
                .then(data => {
                    localStorage.setItem("db-chats", JSON.stringify(data));
                })

            Cells_manager.size_array = JSON.parse(localStorage.getItem("db-chats"))

            Cells_manager.message_list = document.getElementById('tableBody')
            Cells_manager.message_list.innerHTML = ""
            const data_day = date_day_now()
            const div = document.getElementById('tableBody')
            const son = document.createElement('div')
            son.innerHTML = `<div class="date_day">${data_day}</div>`
            div.appendChild(son)
            // const td = document.getElementById(`td-${Cells_manager.chat_n}`)
            // const td_son = document.createElement('td')

            // td.innerHTML = ""


            for (let i = 0; i < Cells_manager.size_array.length; i++) {
                Cells_manager.son = document.createElement('div')
                //     td_son.innerHTML = `<td>${Cells_manager.size_array[i].text}</td>`
                // td.appendChild(td_son)
                let id = Cells_manager.size_array[i].id
                if (Cells_manager.size_array[i].user === Cells_manager.name) {

                    Cells_manager.type_class = "message-balloon"
                    Cells_manager.img = Cells_manager.img_user
                    Cells_manager.type_id = "user_img"
                    Cells_manager.margin_bottom = "margin_bottom"

                }
                else {
                    Cells_manager.img = "bot.png"
                    Cells_manager.type_class = "message-balloon-received"
                    Cells_manager.type_id = "Another_user"
                    Cells_manager.margin_bottom = "margin_bottom_Another_user"
                }
                if (Cells_manager.size_array[i].text !== undefined) {
                    text_message(i, id)
                }
                else {
                    if (Cells_manager.size_array[i].img !== undefined) {
                        image_Message(i, id)
                    }
                    if (Cells_manager.size_array[i].link !== undefined) {
                        link_message(i, id)
                    }
                    if (Cells_manager.size_array[i].tube !== undefined) {
                        youtube_message(i, id)
                    }
                    if (Cells_manager.size_array[i].face !== undefined) {
                        facebook_message(i, id)
                        runfacebookScript()
                    }
                    if (Cells_manager.size_array[i].tiktok !== undefined) {
                        runTikTokScript()
                        tiktok_message(i, id)
                    }
                }

            }
            let scroll_to_bottom = document.getElementById('tableBody');
            scroll_to_bottom.scrollTop = scroll_to_bottom.scrollHeight;
        }





        function PUT(number, value) {

            Cells_manager.new_text = value
            Cells_manager.string_name = "text"

            link_type()
            //   document.getElementById(`message-${number}`).value
            Cells_manager.new_time = time_now()
            const url = `https://db-nmn5.onrender.com/chat${Cells_manager.chat_n}/${number}`
            fetch(url, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: `{
                            "user": "${Cells_manager.name}",
                            "${Cells_manager.string_name}": "${Cells_manager.new_text}",
                            "time": "${Cells_manager.new_time}"
                        }`
            }).then(response => {
                if (!response.ok) {
                    console.error(response)
                    alert('failure') // 1 -- failure
                }
                else {

                }
            })


        }

        function delete_(number) {

            fetch(`https://db-nmn5.onrender.com/chat${Cells_manager.chat_n}/${number}`, {
                method: 'DELETE'

            }).then(response => {
                if (!response.ok) {
                    console.error(response)
                    alert('failure') // 1 -- failure
                } else {
                }
            })
        }

        function edit_or_delete(number) {
            const element = document.getElementById(`message-${number}`);
            const classes = element.className;
            if (classes === "message-balloon") {
                Swal.fire({
                    title: 'Edit or delete the message?',
                    showDenyButton: true,
                    showCancelButton: true,
                    confirmButtonText: 'edit',
                    denyButtonText: `delete`,
                }).then((result) => {
                    /* Read more about isConfirmed, isDenied below */

                    if (result.isConfirmed) {
                        text_editing(number)


                    } else if (result.isDenied) {
                        Swal.fire('The message has been deleted', '', 'info')
                        delete_(number)

                    }
                })
            }
            else {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'You are trying to edit a message that is not yours!',
                })
            }
        }


        function text_editing(number) {
            (async () => {

                const { value: text } = await Swal.fire({
                    input: 'textarea',
                    inputLabel: 'Message',
                    inputPlaceholder: 'Type your message here...',
                    inputAttributes: {
                        'aria-label': 'Type your message here'
                    },
                    showCancelButton: true
                })

                if (text) {
                    [Swal.fire(text)

                    ]
                    PUT(number, text)
                }

            })()
        }

        function addCellClick(divId, number) { //Adds onClick to this div
            const div = document.getElementById(divId);
            div.addEventListener("click", function () {
                // קריאה לפונקציה `cell_click()` עם מספר התמונה
                edit_or_delete(number);
            });
        }



        function runTikTokScript() {
            const script = document.createElement("script");
            script.src = "https://www.tiktok.com/embed.js";
            script.async = false;
            document.body.appendChild(script);
        }
        function runfacebookScript() {
            const script = document.createElement("script");
            script.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2";
            script.async = false;
            document.body.appendChild(script);
        }






        intervalId = setInterval(Push_update, 500)


    </script>
</body>

</html>